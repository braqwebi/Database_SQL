CREATE SCHEMA IF NOT EXISTS `football` DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci ;
USE `football` ;
-- -----------------------------------------------------
-- Table `football`.`academy`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `football`.`academy` ;

CREATE TABLE IF NOT EXISTS `football`.`academy` (
  `id` INT NOT NULL AUTO_INCREMENT,
  `name` VARCHAR(50) NULL DEFAULT NULL,
  `academy_location` VARCHAR(50) NULL DEFAULT NULL,
  `member_registration_id` INT NOT NULL,
  PRIMARY KEY (`id`, `member_registration_id`),
  INDEX `fk_academy_member1_idx` (`member_registration_id` ASC) VISIBLE,
  CONSTRAINT `fk_academy_member1`
    FOREIGN KEY (`member_registration_id`)
    REFERENCES `football`.`member` (`registration_id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8mb4
COLLATE = utf8mb4_0900_ai_ci;

-- -----------------------------------------------------
-- Table `football`.`agent`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `football`.`agent` ;

CREATE TABLE IF NOT EXISTS `football`.`agent` (
  `idagent` INT NOT NULL,
  `agent_name` VARCHAR(50) NULL DEFAULT NULL,
  `member_registration_id` INT NOT NULL,
  PRIMARY KEY (`idagent`, `member_registration_id`),
  INDEX `fk_agent_member1_idx` (`member_registration_id` ASC) VISIBLE,
  CONSTRAINT `fk_agent_member1`
    FOREIGN KEY (`member_registration_id`)
    REFERENCES `football`.`member` (`registration_id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8mb4
COLLATE = utf8mb4_0900_ai_ci;


-- -----------------------------------------------------
-- Table `football`.`attributes`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `football`.`attributes` ;

CREATE TABLE IF NOT EXISTS `football`.`attributes` (
  `atb_index` INT UNSIGNED NOT NULL AUTO_INCREMENT,
  `stamina` INT NULL DEFAULT NULL,
  `strength` INT NULL DEFAULT NULL,
  `speed` INT NULL DEFAULT NULL,
  `defending` INT NULL DEFAULT NULL,
  `attacking` INT NULL DEFAULT NULL,
  `passing` INT NULL DEFAULT NULL,
  `weak_foot` INT NULL DEFAULT NULL,
  `position` VARCHAR(20) NULL DEFAULT NULL,
  `member_registration_id` INT NOT NULL,
  `team_idteam` INT NOT NULL,
  PRIMARY KEY (`atb_index`),
  INDEX `fk_attributes_member_idx` (`member_registration_id` ASC) VISIBLE,
  INDEX `fk_attributes_team1_idx` (`team_idteam` ASC) VISIBLE,
  CONSTRAINT `fk_attributes_member`
    FOREIGN KEY (`member_registration_id`)
    REFERENCES `football`.`member` (`registration_id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_attributes_team1`
    FOREIGN KEY (`team_idteam`)
    REFERENCES `football`.`team` (`idteam`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB
AUTO_INCREMENT = 200
DEFAULT CHARACTER SET = utf8mb4
COLLATE = utf8mb4_0900_ai_ci;


-- -----------------------------------------------------
-- Table `football`.`earnings`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `football`.`earnings` ;

CREATE TABLE IF NOT EXISTS `football`.`earnings` (
  `id` INT NOT NULL,
  `amount` INT NULL DEFAULT NULL,
  `contract_status` VARCHAR(20) NULL DEFAULT NULL,
  `duration` VARCHAR(10) NULL DEFAULT NULL,
  `team_idteam` INT NOT NULL,
  PRIMARY KEY (`id`),
  INDEX `fk_earnings_team1_idx` (`team_idteam` ASC) VISIBLE,
  CONSTRAINT `fk_earnings_team1`
    FOREIGN KEY (`team_idteam`)
    REFERENCES `football`.`team` (`idteam`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8mb4
COLLATE = utf8mb4_0900_ai_ci;


-- -----------------------------------------------------
-- Table `football`.`member`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `football`.`member` ;

CREATE TABLE IF NOT EXISTS `football`.`member` (
  `registration_id` INT NOT NULL AUTO_INCREMENT,
  `full_name` VARCHAR(30) NULL DEFAULT NULL,
  `age` INT NOT NULL,
  `foot` VARCHAR(10) NOT NULL,
  `date_of_birth` VARCHAR(20) NOT NULL,
  `height` INT NOT NULL,
  `weight` INT NOT NULL,
  `current_team` VARCHAR(45) NULL DEFAULT NULL,
  `current_agent` VARCHAR(45) NULL DEFAULT NULL,
  PRIMARY KEY (`registration_id`))
ENGINE = InnoDB
AUTO_INCREMENT = 200
DEFAULT CHARACTER SET = utf8mb4
COLLATE = utf8mb4_0900_ai_ci;


-- -----------------------------------------------------
-- Table `football`.`team`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `football`.`team` ;

CREATE TABLE IF NOT EXISTS `football`.`team` (
  `idteam` INT NOT NULL AUTO_INCREMENT,
  `team_name` VARCHAR(45) NOT NULL,
  `teamcode` INT NULL DEFAULT NULL,
  `member_registration_id` INT NOT NULL,
  PRIMARY KEY (`idteam`),
  UNIQUE INDEX `idteam_UNIQUE` (`idteam` ASC) VISIBLE,
  INDEX `fk_team_member1_idx` (`member_registration_id` ASC) VISIBLE,
  CONSTRAINT `fk_team_member1`
    FOREIGN KEY (`member_registration_id`)
    REFERENCES `football`.`member` (`registration_id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB
AUTO_INCREMENT = 47
DEFAULT CHARACTER SET = utf8mb4
COLLATE = utf8mb4_0900_ai_ci;

-- -----------------------------------------------------
-- SELECT QUERIES FOR USERS
-- -----------------------------------------------------

SELECT m.registration_id, m.full_name, m.foot,
a.position, m.current_team,
a.speed, a.attacking
FROM member m
JOIN attributes a
ON m.registration_id=a.atb_index
WHERE stamina >80 and position='RM'
;

SELECT m.registration_id, m.full_name, m.age,
	m.foot, a.speed, a.defending,a.attacking, 
    a.position
FROM member m
JOIN attributes a
ON m.registration_id = a.atb_index;

SELECT avg(m.age) AS avg_age
FROM member m
JOIN attributes a
ON m.registration_id = a.atb_index
GROUP BY a.position;

SELECT m.registration_id, m.full_name, m.foot,
a.position, m.current_team,
a.speed, a.attacking
FROM member m
JOIN attributes a
ON m.registration_id=a.atb_index
WHERE current_team ='13';

